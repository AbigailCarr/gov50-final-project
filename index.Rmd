---
title: "Gov 50 Final Project"
author: "Abigail Carr"
description: "My Final Project"
output:
  distill::distill_article:
    self_contained: false
---



## Project thoughts

TBD

My Research Question is as follows: 

 

My theory: 

Dependent Variable: The key dependent variable is cumulative cases per 100k people. After joining the data sets, we divided the number of cumulative cases by the number of people in that population/racial group and multiplied by 100K. This tells us the average number of people in that group who would have cumulatively had Covid if the group consisted of 100K. 

TBD

![Visualization 1](./viz1.png)

# Work for Previous Milestones

```{r}

library(tidyverse)

# https://github.com/BroadStreet-Health/Race-and-Ethnicity-Data

covid_new <- read_csv("~/Downloads/covid_data_jan21.csv")

# Separating county into two columns to get county name and state name separate
# Grouping by county, state, and category first so that we can calculate difference
# in daily reporting for those groups separate from one another
# We are creating a variable for the last reported date & its cases so that we can calculate difference
# over time
# Difference over time is the difference in cases from the last report divided by the difference in days from
# the last report

covid_new_w_state <- covid_new |>
  mutate(cumul_cases = `0`) |>
  separate(col = county_names, into = c("county", "state"), sep = ', ',
           extra = 'drop',
           fill = 'warn') %>%
  group_by(county, state, categories) |>
  mutate(last_date_reported = lag(dates),
         last_cases_reported = lag(cumul_cases)) |>
  ungroup() |>
  mutate(dif_days = as.numeric(dates - last_date_reported),
         dif_cases = cumul_cases - last_cases_reported,
         daily_change = dif_cases / dif_days) |>
  arrange(county, state, categories) 

covid_new_w_state %>%
  filter(state == 'Arizona') %>%
  filter(county == 'Apache County') %>%
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases, color = categories))

covid_new_w_state %>%
  filter(state == 'Arizona') %>%
  filter(county == 'Navajo County') %>%
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases, color = categories))

covid_new_w_state %>%
  filter(state == 'Arizona') %>%
  filter(county == 'Yavapai County') %>%
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases, color = categories))

```

```{r}

# https://www2.census.gov/programs-surveys/popest/datasets/2020-2021/counties/asrh/cc-est2021-alldata-04.csv

AZ_county_dems <- read_csv("~/Downloads/cc-est2021-alldata-04.csv") |>
  filter(YEAR == 2,
         AGEGRP == 0)

unique(covid_new_w_state$categories)

AZ_covid <- covid_new_w_state %>%
  filter(state == 'Arizona')

# _pc means per 100k race population

AZ_covid_w_dems <- inner_join(AZ_covid, AZ_county_dems, by = c("county" = "CTYNAME")) |>
  mutate(race_population = case_when(
    categories == "american_indian_alaska_native"  ~ IA_MALE + IA_FEMALE,
    categories == "asian" ~ AA_MALE + AA_FEMALE,
    categories == "black_african_american" ~ BA_MALE + BA_FEMALE,
    categories == "cumulative_cases" ~ TOT_POP,
    categories == "hispanic_(all_races)" ~ H_MALE + H_FEMALE,
    categories == "non-hispanic" ~ NH_MALE + NH_FEMALE,
    categories == "other"  ~ TOT_POP,
    categories == "unknown" ~ TOT_POP,
    categories == "white" ~ WA_MALE + WA_FEMALE,
    categories == "2+_races" ~ TOM_MALE + TOM_FEMALE,
    categories == "native_hawaiian_pacific_islander" ~ NA_MALE + NA_FEMALE,
    categories ==  "not_specified" ~ TOT_POP
  )) |>
  mutate(race = categories) |>
  select(county, state, dates, race, cumul_cases, dif_days, dif_cases, daily_change, race_population) |>
  mutate(cumul_cases_pc = 100000 * cumul_cases / race_population,
         dif_cases_pc = 100000 * dif_cases / race_population,
         daily_change_pc = 100000 * daily_change / race_population)
```


```{r}

AZ_covid_w_dems %>%
  filter(county == 'Apache County') |>
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases_pc, color = race))

AZ_covid_w_dems %>%
  filter(county == 'Navajo County') %>%
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases_pc, color = race))

AZ_covid_w_dems %>%
  filter(county == 'Yavapai County') %>%
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = dif_cases_pc, color = race))

```

```{r}

AZ_covid_w_dems %>%
  filter(county == 'Apache County') |>
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race))

AZ_covid_w_dems %>%
  filter(county == 'Navajo County') %>%
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race))

AZ_covid_w_dems %>%
  filter(county == 'Yavapai County') %>%
  filter(race %in% c("american_indian_alaska_native", "white", "unknown")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race))

```

# Summary Plot of Main Dependent Variable (Cumulative Cases Per 100K)

```{r}

AZ_covid_w_dems |>
  filter(race != 'cumulative_cases') |>
  filter(dates == '2021-01-31') |>
  ggplot(aes(y = race, x = cumul_cases_pc)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = 'Cumulative Cases Per 100K at the County Level',
       y = '',
       title = 'Covid Cases Per 100K by Race in Arizona Counties, as of January 2021') +
  scale_y_discrete(breaks = c('white',
                              'unknown',
                              'other',
                              'hispanic_(all_races)',
                              'black_african_american',
                              'asian',
                              'american_indian_alaska_native'),
                   labels = c('White',
                              'Unknown Race',
                              'Other',
                              'Hispanic',
                              'Black',
                              'Asian',
                              'AI/AN')
                   )

```


# Multiple Regression Code

```{r}

### Making numerical days since start of year

covid_days <- AZ_covid_w_dems |>
  mutate(days = as.numeric(dates - as.Date('2021-01-01')))

lm1 <- lm(data = covid_days,
          formula = cumul_cases_pc ~ days + race + county)

```

AI/AN + Apache:

ccpc = 6871.837 + 53.022(days)

White + Apache:

```{r}

6871.837 - 3369.945
```


ccpc = 6871.837 + 53.022(days) - 3369.945 = 3369.945 + 53.022(days)


#### now in navajo cty

AI/AN + navajo:

```{r}

6871.837 - 1418.259
```

ccpc = 6871.837 + 53.022(days) + 1418.259 = 5453.578 + 53.022(days)

White + navajo:

```{r}

6871.837 - 3369.945 + 1418.259
```


ccpc = 6871.837 + 53.022(days) - 3369.945 + 1418.259 = 4920.151 + 53.022(days)

# Multiple Regression Table

```{r}
### Regression Table
library(jtools)

summ(lm1)


```

# Plots Showing Main Relationships of Interest

```{r}
### Line Graphs of Cases by Race over time in Navajo, Apache, and Yavapai Counties


AZ_covid_w_dems %>%
  filter(county == 'Apache County') |>
  filter(race %in% c("american_indian_alaska_native", "white")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race)) +
  theme_minimal() +
  labs(y = 'Cumulative Cases Per 100K',
       title = 'AI/AN See Similar Covid Rates in Apache County, AZ',
       color = 'Race',
       x = '') +
  scale_color_discrete(labels=c('AI/AN', 'White'))

AZ_covid_w_dems %>%
  filter(county == 'Navajo County') |>
  filter(race %in% c("american_indian_alaska_native", "white")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race)) +
  theme_minimal() +
  labs(y = 'Cumulative Cases Per 100K',
       title = 'AI/AN See Higher Covid Rates in Navajo County, AZ',
       color = 'Race',
       x = '') +
  scale_color_discrete(labels=c('AI/AN', 'White'))

AZ_covid_w_dems %>%
  filter(county == 'Yavapai County') |>
  filter(race %in% c("american_indian_alaska_native", "white")) |>
  ggplot() +
  geom_line(aes(x = dates, y = cumul_cases_pc, color = race)) +
  theme_minimal() +
  labs(y = 'Cumulative Cases Per 100K',
       title = 'AI/AN See Higher Covid Rates in Yavapai County, AZ',
       color = 'Race',
       x = '') +
  scale_color_discrete(labels=c('AI/AN', 'White'))


```


